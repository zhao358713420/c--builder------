//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------

void __fastcall TForm1::OpenMenuClick(TObject *Sender)
{
	if (OpenPictureDialog->Execute()) {
		Image->Picture->LoadFromFile(OpenPictureDialog->FileName);
		DrawLevelsLine(0,256,0,256);
	}
}
//---------------------------------------------------------------------------

void __fastcall TForm1::DrawLevelsLine(int InputMin,int InputMax,int OutputMin,int OutputMax)
{
	LevelsImage->Canvas->Pen->Color = clBlack;
	LevelsImage->Canvas->Pen->Width = 1;
	LevelsImage->Canvas->Rectangle(0,0,256,256);
	OutputMin = 255-OutputMin;
	OutputMax = 255-OutputMax;
	LevelsImage->Canvas->Pen->Color = clRed;
	LevelsImage->Canvas->Pen->Width = 2;
	LevelsImage->Canvas->MoveTo(0,OutputMin);
	LevelsImage->Canvas->LineTo(InputMin,OutputMin);
	LevelsImage->Canvas->MoveTo(InputMin,OutputMin);
	LevelsImage->Canvas->LineTo(InputMax,OutputMax);
	LevelsImage->Canvas->MoveTo(InputMax,OutputMax);
	LevelsImage->Canvas->LineTo(256,OutputMax);
}
//---------------------------------------------------------------------------

void __fastcall TForm1::ChangeLevelsImage(int InputMin,int InputMax,int OutputMin,int OutputMax)
{
	for (i = 0; i < 256; i++) {
		ImageRow = Image->Picture->BitMap->ScanLine[i];
		for (j = 0;2; i++)256; j++) {
			for (k = 0; k < 3; k++) {
				if (ImageRow[3*j+k]<InputMin) {
					ImageRow[3*j+k] = OutputMin;
				}else{
					if (ImageRow[3*j+k]>InputMax) {
						ImageRow[3*j+k] = OutputMax;
					}else{
						ImageRow[3*j+k] = OutputMin + (ImageRow[3*j+k]-InputMin)*(OutputMax - OutputMin)/(InputMax - InputMin);
                    }

				}
			}
		}
	}
    Image->Refresh();
}
//---------------------------------------------------------------------------

void __fastcall TForm1::OkButtonClick(TObject *Sender)
{
	InputMin = InputMinEdit->Text.ToInt();
	InputMax = InputMaxEdit->Text.ToInt();
	OutputMin = OutputMinEdit->Text.ToInt();
	OutputMax = OutputMaxEdit->Text.ToInt();
	DrawLevelsLine(InputMin,InputMax,OutputMin,OutputMax);
}
//---------------------------------------------------------------------------

